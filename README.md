# Query Monitoring Analyzer

Скрипт на Python для анализа поисковых запросов из Яндекс.Вебмастера (Мониторинг запросов).

## Возможности

- Автоматическое определение типа отчёта
- Обработка файлов выгрузки из Яндекс.Вебмастера с любым именем
- Фильтрация данных по списку URL из файла `urls.txt`
- Расчёт ключевых метрик для запросов:
  - Средняя позиция
  - Ежедневная и общая частотность
  - Статистика показов
  - Статистика кликов и CTR
  - Анализ количества слов в запросе
- Автоматическая фильтрация запросов, содержащих URL или домены
- Статистика слов для семантического анализа
- Детальное логирование всех операций

## Требования

- Python 3.10 или выше
- Необходимые библиотеки (указаны в `requirements.txt`):
  - pandas >= 2.0.0
  - openpyxl >= 3.1.0

## Установка

1. Установите Python с [официального сайта](https://www.python.org/downloads/windows/)
2. При установке обязательно поставьте галочку "Add Python to PATH"
3. Установите необходимые библиотеки через pip:
   ```bash
   pip install -r requirements.txt
   ```
   
   Или установите вручную:
   ```bash
   pip install pandas openpyxl
   ```

## Использование

### Интерактивный режим (по умолчанию)

1. Скачайте отчёт по **поисковым запросам** из раздела "Мониторинг запросов" Яндекс.Вебмастера
2. Поместите Excel-файл в одну папку со скриптом
3. **Опционально:** создайте файл `urls.txt` в той же папке и добавьте в него список URL-адресов для фильтрации (по одному адресу на строку)
4. Запустите скрипт: 
   ```bash
   python "QMA 4.2.py"
   ```
5. Выберите нужный файл из списка предложенных
6. Введите адрес вашего сайта в формате `https://site.ru`
7. Дождитесь завершения обработки (с прогресс-баром)

### Автоматический режим (CLI)

Для автоматизации и интеграции в скрипты:

```bash
# Базовое использование
python "QMA 4.2.py" --file report.xlsx --site https://example.com

# Без ожидания Enter (для скриптов)
python "QMA 4.2.py" -f report.xlsx -s https://example.com --no-wait

# Справка
python "QMA 4.2.py" --help

# Версия
python "QMA 4.2.py" --version
```

**Аргументы CLI:**
- `-f, --file` — путь к Excel файлу с отчётом
- `-s, --site` — адрес сайта (https://site.ru)
- `--no-wait` — не ждать нажатия Enter (для автоматизации)
- `-v, --version` — показать версию программы

### Что делает скрипт

Скрипт автоматически:
- Определит тип отчёта
- При наличии `urls.txt` отфильтрует данные по указанным URL
- Удалит запросы, содержащие URL или домены
- Обработает данные и рассчитает метрики (с оптимизированными алгоритмами)
- Покажет прогресс обработки
- Сформирует файл с результатами анализа
- Создаст лог-файл `qma.log` с детальной информацией о работе

## Результаты

Скрипт создаёт Excel-файл с названием: `{домен}-webmaster-{дата}.xlsx`

### Структура выходного файла:

1. **Лист "Семантическое ядро"** — основные данные с метриками:
   - Query — поисковый запрос
   - Относительный URL — путь на сайте
   - Полный URL — полный адрес страницы
   - Число слов в запросе
   - position — средняя позиция
   - Demand — средняя дневная частотность
   - Shows — средние дневные показы
   - Сум. показов — суммарные показы за период
   - Сум. частотность — суммарная частотность за период
   - Ср. число кликов — среднее число кликов в день
   - Сум. кликов — суммарные клики за период
   - CTR — показатель кликабельности (%)

2. **Лист "Отфильтровано"** (опционально) — запросы, содержащие URL или домены

3. **Лист "Статистика слов"** — частота употребления слов в запросах

4. **Лог-файл `qma.log`** — детальная информация о работе программы

## История изменений

### Версия 4.3 (24.10.2025)
- **[PERFORMANCE]** Значительная оптимизация производительности:
  - Векторизация расчёта CTR (ускорение в 10-100 раз)
  - Оптимизация статистики слов через `Counter` (ускорение в 5-10 раз)
- **[FEATURE]** CLI аргументы для автоматизации:
  - `-f/--file` — путь к файлу
  - `-s/--site` — адрес сайта
  - `--no-wait` — режим без ожидания (для скриптов)
  - `--help`, `--version`
- **[UX]** Прогресс-бар для визуализации обработки (библиотека `tqdm`)
- Обновлены зависимости в `requirements.txt`

### Версия 4.2 (24.10.2025)
- **[MAJOR]** Полный рефакторинг кода:
  - Добавлены type hints для всех функций
  - Реализовано детальное логирование в файл `qma.log`
  - Улучшена обработка ошибок (PermissionError, FileNotFoundError и др.)
  - Использование `pathlib.Path` для работы с файловой системой
  - Оптимизирована структура кода
- Добавлен `requirements.txt` для управления зависимостями
- Улучшены пользовательские сообщения
- Обновлена документация

### Версия 4.1 (07.11.2024)
- Добавлена возможность фильтрации данных по списку URL из файла `urls.txt`
- Автоматическое определение наличия файла фильтрации
- Вывод статистики по отфильтрованным данным

### Версия 4.0 (04.11.2024)
- Обновлен формат входного файла в связи с изменениями со стороны Яндекса
- Больше не надо переименовывать файл в `wm.xlsx`, просто запускаем скрипт из той же папки, куда сохранили отчет с любым названием и выбираем подходящий файл
- Автоматическое определение режима анализа
- Оптимизация кода
